<div class="col-md-12" style="margin-bottom:20px;">  
    <h2>Orders List <a class="ml-3 btn btn-primary" href="/njs-admin/manage/promo/add"><i class="fa fa-plus" style="color:#fff"></i></a></h2>

    <% if (flash.success) { %>
    <div class="alert alert-success" role="alert">
        <strong><%= flash.success %></strong>
    </div>
    <% } %>

    <% if (flash.error) { %>
    <div class="alert alert-danger" role="alert">
        <strong><%= flash.error %></strong>
    </div>
    <% } %>
</div>
                    
<div clss="col-md-12">
    <table id="dataTableTrademarks" class="display" style="width:100%">
        <thead>
            <tr>
                <th>Order Code</th>
                <th>Invoice Ref.#</th>
                <th>Total Amount</th>
                <th># Items</th>
                <th>Customer</th>
                <th>Status</th>
                <th>Date Created</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
        <% orders.forEach(function(order,key) {  %>
   
            <tr>
                <%
                let createdAtDate;

                if (order.created_at_formatted) {
                    createdAtDate = order.created_at_formatted
                } else if ( order.updated_at ) {
                    createdAtDate = order.updated_at
                } else if ( order.charge ) {
                    createdAtDate = order.charge.created
                }
                %>
                <td data-sort="<%= moment(createdAtDate).unix() %>"><%= order.orderNumber %></td>
                <td><%= order.invoiceCode ? order.invoiceCode : (order.charge && order.charge.reference ? order.charge.reference : '') %></td>
                <td>
                    <%
                    let totalAmount = 0;
                    if (order.charge && order.charge.amount && !order.charge.order_id) {
                        totalAmount = order.charge.amount / 100
                    } else if(order.charge && order.charge.amount && order.charge.order_id) {
                        totalAmount = order.charge.amount
                    } else if ( order.total_amount ) {
                        totalAmount = order.total_amount
                    }
                    %>
                    <%= helpers.getPriceFormatted(totalAmount) %>
                </td>
                <td><%= order.cartItems ? order.cartItems.length : '1' %></td>
                <% 
                    let customer;
                    let description;
                    if ( order.user ) {
                        customer = order.user.name
                    
                    } else if ( order.action && order.action.user ) {
                        customer = order.action.user.name
                    } else if ( order.charge && order.charge.metadata ) {
                        customer = order.charge.metadata.customer
                        description = order.charge.metadata.description
                    }
                %>
                <td><%= customer %></td>
                <td><%= order.paid ? 'Paid' : (order.charge && order.charge.amount_captured ? 'Paid' : 'Unpaid') %></td>
               
                <td ><%= moment(createdAtDate).format('MMM D, YYYY') %></td>

                <td>
                    <a href="/njs-admin/manage/orders/view/<%= order._id %>"><i class="fa fa-eye"></i></a>
                    <a target="_blank" href="/pdf/invoice/<%= order.orderNumber %>"><i class="fa fa-file-pdf"></i></a>
                </td>
            </tr>
        <%  }) %>
        </tbody>
    </table>
</div>